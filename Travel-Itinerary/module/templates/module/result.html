{% load static %}
<html lang="en"><head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Jekyll v3.8.5">
    <title>{{page_title}}</title>

    <link rel="canonical" href="https://getbootstrap.com/docs/4.3/examples/blog/">

    <!-- Bootstrap core CSS -->
<link rel="stylesheet" type="text/css" href="{% static "vendor/bootstrap/css/bootstrap.min.css" %}">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }

      #map_canvas1{
        height:500px;
        height:500px;
      }
      #map_canvas2{
        height:500px;
        height:500px;
      }

      .map-marker {
        position: absolute;
        background-color: #fff;
        width: 155px;
        height: 40px;
        border-radius: 100px;
        padding: 4px;
        padding-right: 15px;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        top: -42px;
        left: -77px;
        -webkit-box-shadow: 0 2px 5px #999;
        box-shadow: 0 2px 5px #999;
        z-index: 4;
        color: #4a4a4a;
      }

      .map-marker .loc-detil {
        position: relative;
        z-index: 2;
        width: 32px;
        height: 32px;
        float: left;
        border-radius: 20px;
        color: #fff;
        text-align: center;
        -webkit-box-sizing: border-box;
        box-sizing: border-box;
        font-size: 16px;
        line-height: 19px;
        padding-top: 2px;
      }

      .map-marker .loc-name {
        margin-top: 2px;
        margin-left: 43px;
        font-size: 15px;
        white-space: nowrap;
        overflow: hidden;
        -o-text-overflow: ellipsis;
        text-overflow: ellipsis;
        font-weight: 400;
      }

      .map-marker .loc-name span {
        display: block;
        font-size: 10px;
        margin-top: -2px;
        font-weight: 200;
      }

      .days-selection-outer {
        background: #000000;
        color: #fff;
        margin: 0 auto;
        height: 50px;
        /*overflow-y: auto;*/
      }

      .days-selection ul {
        list-style: none;
        padding-top: 10px;
        height: 100%;
      }

      .days-selection ul li {
        float: left;
      }

      .days-selection .fixed-dt {
        padding-top: 5px;
        font-weight: bold;
        margin-right: 15px;
        font-size: 17px;
      }

      .days-selection .select-day {
        cursor: pointer;
        background: #fff;
        color: #000;
        padding: 3px 10px;
        border-radius: 3px;
        margin-right: 8px;
        font-size: 18px;
      }

      .days-selection .select-day.selected {
        background: #4285F4;
        color: #fff;
      }
    </style>
    <!-- Custom styles for this template -->
    <link href="https://fonts.googleapis.com/css?family=Playfair+Display:700,900" rel="stylesheet">
    <!-- Custom styles for this template-->
    <link href="{% static "css/blog.css" %}" rel="stylesheet">
    {# <link rel="stylesheet" type="text/css" href="{% static "css/style.css" %}"> #}
  </head>
  <body>
<div class="container">
  <header class="blog-header py-3">
      <div class="days-selection-outer">
        <div class="days-selection h-center">
          <ul>
            <li class="fixed-dt">Hari ke - </li>
            {% for cluster, result in results.items %}
              {% if cluster == 1 %}
                <li class="select-day selected" day="{{cluster}}">{{cluster}}</li>
              {% else %}
                <li class="select-day" day="{{cluster}}">{{cluster}}</li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>
      </div>
  </header>
    <div class="row mb-2">
    {% for cluster, result in results.items %}
      <div class="col-sm-6">
        <div class="row no-gutters border rounded overflow-hidden flex-md-row mb-4 shadow-sm h-md-250 position-relative">
          <div class="col p-4 d-flex flex-column position-static">
            {# {% for day in days %} #}
              <h3 class="mb-0">Rute Hari Ke : {{cluster}} </h3>
            {# {% endfor %} #}
            <div class="mb-1 text-muted"></div>
            <ul style="list-style-type:square;">
              {% for route in result.routes %}
              <li>{{route}}</li>
              {% endfor %}
              <br>
            </ul>
            <p>Total Jarak : {{result.distance}} KM</p>
            <p>Total Durasi : {{result.duration}}</p>
          </div>
          <div class="col-auto d-none d-lg-block">
            <svg class="bd-placeholder-img" width="200" height="250" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid slice" focusable="false" role="img" aria-label="Placeholder: Thumbnail"><rect width="100%" height="100%" fill="#55595c"></rect></button><text x="50%" y="50%" fill="#eceeef" dy=".3em">tes</text></svg>
            {# <h5 id="select">test</h5> #}
          </div>

        </div>
      </div>
    {% endfor %}
    </div>
    {% for cluster, result in results.items %}
      <div id="map_canvas{{cluster}}"></div>
    {% endfor %}
</div>

<!-- Footer -->
<footer class="page-footer font-small cyan darken-3">

  <!-- Footer Elements -->
  <div class="container">

    <!-- Grid row-->
    <div class="row">

      <!-- Grid column -->
      <div class="col-md-12 py-5">
        <div class="mb-5 flex-center">

          <!-- Facebook -->
          <a class="fb-ic">
            <i class="fab fa-facebook-f fa-lg white-text mr-md-5 mr-3 fa-2x"> </i>
          </a>
          <!-- Twitter -->
          <a class="tw-ic">
            <i class="fab fa-twitter fa-lg white-text mr-md-5 mr-3 fa-2x"> </i>
          </a>
          <!-- Google +-->
          <a class="gplus-ic">
            <i class="fab fa-google-plus-g fa-lg white-text mr-md-5 mr-3 fa-2x"> </i>
          </a>
          <!--Linkedin -->
          <a class="li-ic">
            <i class="fab fa-linkedin-in fa-lg white-text mr-md-5 mr-3 fa-2x"> </i>
          </a>
          <!--Instagram-->
          <a class="ins-ic">
            <i class="fab fa-instagram fa-lg white-text mr-md-5 mr-3 fa-2x"> </i>
          </a>
          <!--Pinterest-->
          <a class="pin-ic">
            <i class="fab fa-pinterest fa-lg white-text fa-2x"> </i>
          </a>
        </div>
      </div>
      <!-- Grid column -->

    </div>
    <!-- Grid row-->

  </div>
  <!-- Footer Elements -->

  <!-- Copyright -->
  <div class="footer-copyright text-center py-3">Â© 2018 Copyright:
    <a href="https://mdbootstrap.com/education/bootstrap/"> MDBootstrap.com</a>
  </div>
  <!-- Copyright -->

</footer>
<!-- Footer -->
<script src="{% static "js/jquery-3.2.1.min.js" %}"></script>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCMxUjBrjxJGKIq48vQAAwbN4lLSlD16FQ&libraries=geometry,places"></script>
<script type="text/javascript" src="{% static "js/richmarker.js" %}"></script>
<script type="text/javascript">
      function initialize() {
        window.map = [];

        function renderDirections(day, result, color) {
          var polylineOptions = {
            strokeColor: color,
            strokeWeight: 5,
            // strokeHeight: 10,
            strokeOpacity: 1.0
          };

          var dr = new google.maps.DirectionsRenderer({
            polylineOptions: polylineOptions,
            map: window.map[day],
            preserveViewport: true
          });

          dr.setDirections(result);
        }

        function requestDirections(day, locations, color, lat, lng, place_id) {
          var elId = 'map_canvas' + day;

          setTimeout(function () {
            window.map[day] = new google.maps.Map(document.getElementById(elId), {
              zoom: 12,
              mapTypeId: google.maps.MapTypeId.ROADMAP,
              center: new google.maps.LatLng(-7.797068, 110.370529)
            });

            var request = {
              travelMode: google.maps.DirectionsTravelMode.DRIVING,
              optimizeWaypoints: true
            };

            if (locations.length > 1) {
              request.waypoints = [];
            }

            var marker = [];
            for (var i = 0; i < locations.length; i++) {

              if (i == 0 || i == locations.length){
                var content = '<div class="map-marker">' +
                '<div class="loc-detil" style="background-color:' + color + '"></div>' + 
                '<div class="loc-name">' + 'Lokasi Anda' + '<br>';
              }else{
                var content = '<div class="map-marker">' +
                '<div class="loc-detil" style="background-color:' + color + '"></div>' + 
                '<div class="loc-name">' + locations[i] + '<br>';
              }

              if (i == 0 || i == locations.length) {
                content += ' <span>Lokasi Awal & Akhir</span></div>';
              } else {
                content += ' <span>Destinasi ke-' + i + '</span></div>';
              }

              content += '</div>';

              // marker[i] = new RichMarker({
              //   position: new google.maps.LatLng(lat, lng),
              //   map: window.map[day],
              //   content: content,
              //   shadow: 0
              // });

              marker[i] = new RichMarker({
                position: new google.maps.LatLng(lat[i], lng[i]),
                map: window.map[day],
                content: content,
                shadow: 0
              });

              if (i === 0) {
                request.origin = marker[i].getPosition();
              } else if (i === locations.length - 1) {
                request.destination = marker[i].getPosition();
              } else {
                request.waypoints.push({
                  location: marker[i].getPosition(),
                  stopover: true
                });
              }
            }

            var ds = new google.maps.DirectionsService();

            ds.route(request, function (response, status) {
              if (status === 'OK') {
                renderDirections(day, response, color);

                // var lastLoc = locations[locations.length - 1];
                request.origin = request.destination;
                request.waypoints = undefined;
                request.destination = locations[locations.length - 1];

                ds.route(request, function (response, status) {
                  if (status === 'OK') {
                    renderDirections(day, response, '#' + color.substr(1).split('').reverse().join(''));
                  } else {
                    console.log('Could not display directions due to: ' + status);
                  }
                });
              } else {
                console.log('Could not display directions due to: ' + status);
              }
            });
          }, 2500);
        }

        var Data = '{{result_json}}';
        var itineraryData = JSON.parse(Data.replace(/&quot;/g, '"'));

        function getRandomColor() {
          var letters = '0123456789ABCDEF';
          var color = '#';
          for (var i = 0; i < 6; i++) {
            color += letters[Math.floor(Math.random() * 16)];
          }
        return color;
      }

        $('.select-day').click(function() {
          var self = $(this);
          var buttons = $('.select-day');
          var color = getRandomColor();

          buttons.each(function () {
            $(this).removeClass('selected');
          });

          self.addClass('selected');

          var day = $(this).attr('day');

          var boxes = $('.map-box');

          boxes.each(function () {
            $(this).hide();
          });

          $('.map-box-' + day).fadeIn(500);

          var data = itineraryData[day];

          requestDirections(day, data.routes, color, data.lat, data.lng, data.place_id);
        });

        $('.select-day')[0].click();
      }

      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
    
</body>
</html> 